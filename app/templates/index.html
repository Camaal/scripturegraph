{% extends "base.html" %}

{% block content %}
<div id="sourceBookName">
  <h1>{{defaultbookname}}</h1>
<!--  <div class="color-scale">-->
<!--      <div class="min">1</div>-->
<!--      <div class="max">436</div>-->
<!--  </div>-->
</div>
<div class="parallel">
  <div id="chapter_menu" menu_name="chapter">
        <ul>
            {% for chapter in chapterDegrees %}
            <li class="chapterItem">

                <a href="#ch{{chapter.chapter}}" class="chapterFilter" chapter_id="{{chapter.chapter}}" style="color: #1c1c1c;">
                    <div class="name">{{chapter.chapter}}</div>
                </a>
                <div class="degreeNumber" style="background-color: rgb{{chapter.total | chapterColor}};">{{chapter.total | numberFormat}}</div>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="collection">
      <div class="verses">
        <div id="source_text">
            {% for i in range(1, dchapters+1)%}
                <h4 id="ch{{i}}">Chapter {{i}}</h4>
                {% for verse in dverses%}
                    {% if verse.chapter==i%}
                    <span class="scripture">
                           <span>
                              <span class="verse_num" data-degree="{{verse.degree}}">{{verse.verse}}</span>
                               <a href="#" class="verseFilter {% if verse.degree >= 50 %} above_avg {% endif %} {% if verse.redLetter == 'TRUE' %} jesus_words {% endif %}" verse_id="{{verse.id}}" style="text-decoration: none; color:#1c1c1c;">{{verse.text}}</a><sup style="color: rgb{{verse.degree | verseColor}}">{{verse.degree}}</sup>
                           </span>
                    </span>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>
      </div>
    </div>
    <div id="graph-container" class="collection-target">
      <div id="graph"></div>
      <div class="verses">
        <div id="target_text" class="cross-references">
            {% for item in joins%}
                    <h6 class="character">{{item.author}}</h6>
                    <span id="{{item.id}}" class="scripture">
                         <span class="{% if item.degree >= 50 %} above_avg {% endif %} {% if item.redLetter == 'TRUE' %} jesus_words {% endif %}">
                            {{item.text}}
                         </span>
                    </span>
                    <h6 class="reference-name">{{item.bookName}} {{item.chapter}}: {{item.verse}} | {{item.degree}} cross references</h6>
            {% endfor %}
          {% for item in source_joins%}
                    <h6 class="character">{{item.author}}</h6>
                    <span id="{{item.id}}" class="scripture">
                         <span class="{% if item.degree >= 50 %} above_avg {% endif %} {% if item.redLetter == 'TRUE' %} jesus_words {% endif %}">
                            {{item.text}}<sup>{{item.degree}}</sup>
                         </span>
                    </span>
                    <h6 class="reference-name">{{item.bookName}} {{item.chapter}}: {{item.verse}} | {{item.degree}} cross references</h6>
            {% endfor %}
        </div>
      </div>
    </div>
</div>

{% endblock %}

{% block script %}
<script type="application/javascript">
    $(document).ready(function () {

        $('.verseFilter').on('click', function (){
            var verse_id = parseInt($(this).attr('verse_id'));

            var getSourceByBook = $.ajax({
                url: '/filter_target',
                type: 'POST',
                data: {id: verse_id}
            });

            getSourceByBook.done(function (data) {
                $('#graph-container').html(data);
            })
        });
    });
</script>
{% endblock %}